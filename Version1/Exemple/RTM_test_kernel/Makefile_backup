PREP=
FC=$(PREP) gfortran-4.5
CC = gcc-4.5
INCLUDE = 
FFLAGS  = -g -O3

PRODUCTIVITY=../productivity_link
PRODUCTIVITY_SOURCE_FILES=$(PRODUCTIVITY).c $(PRODUCTIVITY)_helper.c
PRODUCTIVITY_OBJECT_FILES=$(patsubst %.c,%.o,$(PRODUCTIVITY_SOURCE_FILES))


LFLAGS_PRODUCTIVITY=-lpthread -luuid -ldl -lrt
LFLAGS = -L.. -lpower_instru -lpthread

PLUGIN = -fplugin=powerplugin.so

ALL     = test_kernel 


test_kernel: test_kernel.o mygetticks.o
	$(FC) $^ $(FFLAGS) $(INCLUDE) $(LFLAGS_PRODUCTIVITY) $(PRODUCTIVITY_OBJECT_FILES) -o $@ $(LFLAGS)

%.o: %.f90
	$(FC) $(FFLAGS) -c $^ $(INCLUDE) -o $@ $(PLUGIN)

%.o: %.c
	$(CC) -c $^ $(INCLUDE) -o $@

clean:
	rm -rf *.o *.mod *.MOD core* *~ *.inst.* *.pdb $(ALL)
